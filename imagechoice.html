<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>그림 퀴즈</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* 기본 스타일 */
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #f0f8ff;
            margin: 0;
            padding: 0;
        }
        h1 {
            margin: 20px 0;
            color: #333;
            font-size: 2em;
        }
        /* 공통 스타일 */
        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px 0;
            padding: 0 10px;
        }
        #controls > * {
            margin: 5px 0;
            width: 100%;
            max-width: 300px;
        }
        select, button, input {
            padding: 10px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #ffa500;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #ff8c00;
        }
        #score {
            font-size: 1.2em;
            margin: 10px 0;
            transition: color 0.5s;
        }
        /* 퀴즈 게임 스타일 */
        #quizContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        #questionImage {
            width: 300px;
            height: 300px;
            background-color: #fff;
            border: 2px solid #ccc;
            border-radius: 10px;
            background-size: cover;
            background-position: center;
            position: relative;
            margin-bottom: 20px;
        }
        #feedback {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2em;
            font-weight: bold;
        }
        /* 정답 표시 영역 */
        #correctAnswer {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 1em;
            color: #fff;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 5px 10px;
            border-radius: 5px;
            display: none; /* 기본적으로 숨김 */
        }
        #options {
            display: grid;
            grid-template-columns: repeat(2, 150px);
            gap: 10px;
        }
        .option-button {
            padding: 15px;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #87cefa;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .option-button:hover {
            background-color: #00bfff;
        }
        /* 성공 메시지 스타일 */
        #successMessage {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            z-index: 1000;
            display: none;
            padding: 20px;
            box-sizing: border-box;
        }
        #successMessage img {
            width: 80px;
            margin-bottom: 20px;
        }
        #successMessage button {
            margin-top: 20px;
        }
        /* 기록 섹션 스타일 (모달) */
        #recordSection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* 반투명 배경 */
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        #recordContent {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80%; /* 높이 제한 추가 */
            overflow-y: auto; /* 스크롤 추가 */
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        #recordTable {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        #recordTable th, #recordTable td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }
        /* 미디어 쿼리로 화면 크기에 맞게 조정 */
        @media (max-width: 768px) {
            #questionImage {
                width: 200px;
                height: 200px;
            }
            #options {
                grid-template-columns: repeat(1, 200px);
            }
        }
        .correct-answer {
            text-decoration: underline;
        }
        /* 정답 애니메이션: 확대되면서 서서히 나타나기 */
        @keyframes correctAnimation {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
            100% {
                transform: scale(1);
            }
        }

        /* 오답 애니메이션: 흔들리면서 빨리 사라지기 */
        @keyframes incorrectAnimation {
            0% {
                transform: translateX(0);
                opacity: 1;
            }
            25% {
                transform: translateX(-10px);
            }
            50% {
                transform: translateX(10px);
            }
            75% {
                transform: translateX(-10px);
            }
            100% {
                transform: translateX(0);
                opacity: 0;
            }
        }

        /* 정답 애니메이션 클래스 */
        .animate-correct {
            animation: correctAnimation 1s ease-out forwards;
        }

        /* 오답 애니메이션 클래스 */
        .animate-incorrect {
            animation: incorrectAnimation 1s ease-out forwards;
        }
        #viewRecordsButton {
            background-color: #ffa500;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #viewRecordsButton:hover {
            background-color: #ff8c00;
        }
    </style>
    
    <!-- Firebase SDK 추가 -->
    <!-- Firebase App (필수) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <!-- Firebase Firestore -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>그림 퀴즈
    <button id="viewRecordsButton" style="font-size: 0.5em; margin-left: 10px; padding: 5px 10px;">기록 보기</button>
    </h1>
    <!-- 게임 시작 섹션 -->
    <div id="controls">
        <!-- 카테고리 선택 -->
        <select id="categorySelect">
            <option value="animals" selected>동물</option>
            <option value="foods">음식</option> <!-- '식물'에서 '음식'으로 수정 -->
            <!-- 추가 카테고리 옵션을 여기에 추가 -->
        </select>
        
        <!-- 난이도 선택 -->
        <select id="difficultySelect">
            <option value="easy" selected>쉬움</option>
            <option value="medium">보통</option>
            <option value="hard">어려움</option>
        </select>
        
        <!-- 게임 시작 버튼 -->
        <button id="startQuizGame">게임 시작</button>
    </div>
    <div id="score">점수: 0</div>
    <div id="quizContainer" style="display: none;">
        <div id="questionImage">
            <div id="feedback"></div>
            <div id="correctAnswer"></div> <!-- 정답 표시 영역 추가 -->
        </div>
        <div id="options">
            <!-- 보기 버튼이 여기에 생성됩니다 -->
        </div>
    </div>

    <!-- 성공 메시지 -->
    <div id="successMessage">
        <img src="https://cdn-icons-png.flaticon.com/128/1365/1365358.png" alt="축하 이미지">
        <div>축하해요! 모든 문제를 완료했어요!</div>
        <button id="saveRecordButton">기록 저장</button>
        <button id="restartButton">다시 하기</button>
    </div>

    <!-- 기록 섹션 (모달) -->
    <div id="recordSection">
        <div id="recordContent">
            <h2>🎉 클리어 기록 저장 🎉</h2>
            <label for="playerName">이름을 입력하세요:</label>
            <input type="text" id="playerName" placeholder="이름">
            <button id="submitRecordButton">저장</button>
            <h3>기록 보기</h3>
            <table id="recordTable">
                <thead>
                    <tr>
                        <th>이름</th>
                        <th>점수</th>
                        <!--<th>날짜</th>--!>
                    </tr>
                </thead>
                <tbody>
                    <!-- 기록이 여기에 추가됩니다 -->
                </tbody>
            </table>
            <button id="closeRecordSection">닫기</button>
        </div>
    </div>

    <!-- 오디오 요소 -->
    <audio id="correctSoundEffect" src="https://www.soundjay.com/buttons/sounds/button-16.mp3" preload="auto"></audio> <!-- "띵동" 소리 -->
    <audio id="incorrectSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>

    <script>
        // Firebase 초기화 (Firebase 콘솔에서 얻은 설정 정보로 대체)
        const firebaseConfig = {
            apiKey: "AIzaSyBbyta3aYZuMcaWDFyUP_LqQFDXr95_m6U",
            authDomain: "imagechoice20241125.firebaseapp.com",
            projectId: "imagechoice20241125",
            storageBucket: "imagechoice20241125.firebasestorage.app",
            messagingSenderId: "4727525381",
            appId: "1:4727525381:web:a90aab12dbdba5de430c6c"
        };
        
        // Firebase 초기화
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 카테고리별 옵션 풀 정의
        const optionPools = {
            animals: ['Tiger', 'Elephant', 'Lion', 'Giraffe', 'Zebra', 'Kangaroo', 'Panda', 'Dolphin', 'Whale', 'Shark',
'Cheetah', 'Wolf', 'Fox', 'Bear', 'Rabbit', 'Deer', 'Horse', 'Sheep', 'Goat', 'Pig',
'Dog', 'Cat', 'Mouse', 'Rat', 'Squirrel', 'Eagle', 'Owl', 'Parrot', 'Penguin', 'Flamingo',
'Camel', 'Crocodile', 'Turtle', 'Frog', 'Snake', 'Lizard', 'Butterfly', 'Bee', 'Ant', 'Octopus',
'Crab', 'Jellyfish', 'Starfish', 'Seal', 'Walrus', 'Peacock', 'Turkey', 'Chicken', 'Duck', 'Goose',
'Hedgehog', 'Raccoon', 'Koala', 'Platypus', 'Armadillo', 'Sloth', 'Gazelle', 'Bison', 'Llama', 'Alpaca',
'Seahorse', 'Clownfish', 'Swordfish', 'Polar Bear', 'Arctic Fox', 'Meerkat', 'Jaguar', 'Antelope', 'Gorilla',
'Orangutan', 'Bat', 'Toucan', 'Pelican', 'Stingray'],
            foods: ['Pizza', 'Hamburger', 'Pasta', 'Sandwich', 'Rice', 'Noodles', 'Soup', 'Salad', 'Bread', 'Cheese',
     'Milk', 'Yogurt', 'Egg', 'Chicken', 'Beef', 'Fish', 'Shrimp', 'Apple', 'Banana', 'Grape',
     'Orange', 'Mango', 'Strawberry', 'Watermelon', 'Pineapple', 'Carrot', 'Potato', 'Tomato', 'Cucumber', 'Broccoli',
     'Ice Cream', 'Cake', 'Chocolate', 'Candy', 'Cookie', 'Popcorn', 'Chips', 'Honey', 'Butter', 'Jam',
     'Pancake', 'Waffle', 'Toast', 'Sushi', 'Dumpling', 'Taco', 'Hotdog', 'Cereal', 'Juice', 'Smoothie','Kimchi']
        };

        // 질문 데이터 (카테고리별로 분류, 난이도별로는 분류하지 않음)
        const questions = {
            animals: [
                    {
                        image: 'images/고슴도치.png', // 사자 이미지 URL
                        correct: 'Hedgehog'
                    },
                    {
                        image: 'images/너구리.png', // 사자 이미지 URL
                        correct: 'Raccoon'
                    },
                    {
                        image: 'images/코알라.png', // 사자 이미지 URL
                        correct: 'Koala'
                    },
                    {
                        image: 'images/오리너구리.png', // 사자 이미지 URL
                        correct: 'Platypus'
                    },
                    {
                        image: 'images/아르마딜로.png', // 사자 이미지 URL
                        correct: 'Armadillo'
                    },
                    {
                        image: 'images/나무늘보.png', // 사자 이미지 URL
                        correct: 'Sloth'
                    },
                    {
                        image: 'images/가젤.png', // 사자 이미지 URL
                        correct: 'Gazelle'
                    },
                    {
                        image: 'images/물소.png', // 사자 이미지 URL
                        correct: 'Bison'
                    },
                    {
                        image: 'images/라마.png', // 사자 이미지 URL
                        correct: 'Llama'
                    },
                    {
                        image: 'images/알파카.png', // 사자 이미지 URL
                        correct: 'Alpaca'
                    },
                    {
                        image: 'images/해마.png', // 사자 이미지 URL
                        correct: 'Seahorse'
                    },
                    {
                        image: 'images/니모.png', // 사자 이미지 URL
                        correct: 'Clownfish'
                    },
                    {
                        image: 'images/황새치.png', // 사자 이미지 URL
                        correct: 'Swordfish'
                    },
                    {
                        image: 'images/북극곰.png', // 사자 이미지 URL
                        correct: 'Polar Bear'
                    },
                    {
                        image: 'images/북극여우.png', // 사자 이미지 URL
                        correct: 'Arctic Fox'
                    },
                    {
                        image: 'images/미어캣.png', // 사자 이미지 URL
                        correct: 'Meerkat'
                    },
                    {
                        image: 'images/재규어.png', // 사자 이미지 URL
                        correct: 'Jaguar'
                    },
                    {
                        image: 'images/영양.png', // 사자 이미지 URL
                        correct: 'Antelope'
                    },
                    {
                        image: 'images/고릴라.png', // 사자 이미지 URL
                        correct: 'Gorilla'
                    },
                    {
                        image: 'images/오랑우탄.png', // 사자 이미지 URL
                        correct: 'Orangutan'
                    },
                    {
                        image: 'images/박쥐.png', // 사자 이미지 URL
                        correct: 'Bat'
                    },
                    {
                        image: 'images/Toucan.png', // 사자 이미지 URL
                        correct: 'Toucan'
                    },
                    {
                        image: 'images/팰리컨.png', // 사자 이미지 URL
                        correct: 'Pelican'
                    },
                    {
                        image: 'images/가오리.png', // 사자 이미지 URL
                        correct: 'Stingray'
                    },
                    {
                        image: 'images/거위.png', // 사자 이미지 URL
                        correct: 'Goose'
                    },
                    {
                        image: 'images/오리.png', // 사자 이미지 URL
                        correct: 'Duck'
                    },
                    {
                        image: 'images/불가사리.png', // 사자 이미지 URL
                        correct: 'Starfish'
                    },
                    {
                        image: 'images/게.png', // 사자 이미지 URL
                        correct: 'Crab'
                    },
                    {
                        image: 'images/문어.png', // 사자 이미지 URL
                        correct: 'Octopus'
                    },
                    {
                        image: 'images/개미.png', // 사자 이미지 URL
                        correct: 'Ant'
                    },
                    {
                        image: 'images/벌.png', // 사자 이미지 URL
                        correct: 'Bee'
                    },
                    {
                        image: 'images/나비.png', // 사자 이미지 URL
                        correct: 'Butterfly'
                    },
                    {
                        image: 'images/도마뱀.png', // 사자 이미지 URL
                        correct: 'Lizard'
                    },
                    {
                        image: 'images/뱀.png', // 사자 이미지 URL
                        correct: 'Snake'
                    },
                    {
                        image: 'images/개구리.png', // 사자 이미지 URL
                        correct: 'Frog'
                    },
                    {
                        image: 'images/거북이.png', // 사자 이미지 URL
                        correct: 'Turtle'
                    },
                    {
                        image: 'images/악어.png', // 사자 이미지 URL
                        correct: 'Crocodile'
                    },
                    {
                        image: 'images/낙타.png', // 사자 이미지 URL
                        correct: 'Camel'
                    },
                    {
                        image: 'images/플라밍고.png', // 사자 이미지 URL
                        correct: 'Flamingo'
                    },
                    {
                        image: 'images/펭귄.png', // 사자 이미지 URL
                        correct: 'Penguin'
                    },
                    {
                        image: 'images/앵무새.png', // 사자 이미지 URL
                        correct: 'Parrot'
                    },
                    {
                        image: 'images/올빼미.png', // 사자 이미지 URL
                        correct: 'Owl'
                    },
                    {
                        image: 'images/토끼.png', // 사자 이미지 URL
                        correct: 'Rabbit'
                    },
                    {
                        image: 'images/염소.png', // 사자 이미지 URL
                        correct: 'Goat'
                    },
                    {
                        image: 'images/돼지.png', // 사자 이미지 URL
                        correct: 'Pig'
                    },
                    {
                        image: 'images/고양이.png', // 사자 이미지 URL
                        correct: 'Cat'
                    },
                    {
                        image: 'images/쥐.png', // 사자 이미지 URL
                        correct: 'Mouse'
                    },
                    {
                        image: 'images/다람쥐.png', // 사자 이미지 URL
                        correct: 'Squirrel'
                    },
                    {
                        image: 'images/독수리.png', // 사자 이미지 URL
                        correct: 'Eagle'
                    },
                    {
                        image: 'images/상어.png', // 사자 이미지 URL
                        correct: 'Shark'
                    },
                    {
                        image: 'images/고래.png', // 사자 이미지 URL
                        correct: 'Whale'
                    },
                    {
                        image: 'images/사자.png', // 사자 이미지 URL
                        correct: 'Lion'
                    },
                    {
                        image: 'images/호랑이.png', // 호랑이 이미지 URL
                        correct: 'Tiger'
                    },
                    {
                        image: 'images/표범.png', // 호랑이 이미지 URL
                        correct: 'Leopard'
                    },
                    {
                        image: 'images/얼룩말.png', // 호랑이 이미지 URL
                        correct: 'Zebra'
                    },
                    {
                        image: 'images/기린.png', // 호랑이 이미지 URL
                        correct: 'Giraffe'
                    },
                    {
                        image: 'images/코끼리.png', // 호랑이 이미지 URL
                        correct: 'Elephant'
                    },                    
                    {
                        image: 'images/곰.png', // 호랑이 이미지 URL
                        correct: 'Bear'
                    },                    
                    {
                        image: 'images/말.png', // 호랑이 이미지 URL
                        correct: 'Horse'
                    },                    
                    {
                        image: 'images/캥거루.png', // 호랑이 이미지 URL
                        correct: 'Kangaroo'
                    },                    
                    {
                        image: 'images/판다.png', // 호랑이 이미지 URL
                        correct: 'Panda'
                    },                    
                    {
                        image: 'images/늑대.png', // 호랑이 이미지 URL
                        correct: 'Wolf'
                    },                    
                    {
                        image: 'images/여우.png', // 호랑이 이미지 URL
                        correct: 'Fox'
                    },                    
                    {
                        image: 'images/사슴.png', // 호랑이 이미지 URL
                        correct: 'Deer'
                    },                    
                    {
                        image: 'images/코뿔소.png', // 호랑이 이미지 URL
                        correct: 'Rhinoceros'
                    },                    
                    {
                        image: 'images/치타.png', // 호랑이 이미지 URL
                        correct: 'Cheetah'
                    },                    
                    {
                        image: 'images/하이에나.png', // 호랑이 이미지 URL
                        correct: 'Hyena'
                    },                    
                    {
                        image: 'images/버팔로.png', // 호랑이 이미지 URL
                        correct: 'Buffalo'
                    },                    
                    {
                        image: 'images/침펜지.png', // 호랑이 이미지 URL
                        correct: 'Chimpanzee'
                    },                    
                    {
                        image: 'images/하마.png', // 호랑이 이미지 URL
                        correct: 'Hippopotamus'
                    },                    
                    {
                        image: 'images/수달.png', // 호랑이 이미지 URL
                        correct: 'Otter'
                    },                    
                    // 더 많은 쉬운 동물 질문을 추가하세요
                ],
            foods: [
                    {
                        image: 'images/김치.png', // 장미 이미지 URL
                        correct: 'Kimchi'
                    },
                    {
                        image: 'images/핫도그.png', // 장미 이미지 URL
                        correct: 'Hotdog'
                    },
                    {
                        image: 'images/초밥.png', // 장미 이미지 URL
                        correct: 'Sushi'
                    },
                    {
                        image: 'images/토스트.png', // 장미 이미지 URL
                        correct: 'Toast'
                    },
                    {
                        image: 'images/와플.png', // 장미 이미지 URL
                        correct: 'Waffle'
                    },
                    {
                        image: 'images/버터.png', // 장미 이미지 URL
                        correct: 'Butter'
                    },
                    {
                        image: 'images/팝콘.png', // 장미 이미지 URL
                        correct: 'Popcorn'
                    },
                    {
                        image: 'images/사탕.png', // 장미 이미지 URL
                        correct: 'Candy'
                    },
                    {
                        image: 'images/초콜릿.png', // 장미 이미지 URL
                        correct: 'Chocolate'
                    },
                    {
                        image: 'images/케이크.png', // 장미 이미지 URL
                        correct: 'Cake'
                    },
                    {
                        image: 'images/아이스크림.png', // 장미 이미지 URL
                        correct: 'IceCream'
                    },
                    {
                        image: 'images/브로콜리.png', // 장미 이미지 URL
                        correct: 'Broccoli'
                    },
                    {
                        image: 'images/오이.png', // 장미 이미지 URL
                        correct: 'Cucumber'
                    },
                    {
                        image: 'images/토마토.png', // 장미 이미지 URL
                        correct: 'Tomato'
                    },
                    {
                        image: 'images/감자.png', // 장미 이미지 URL
                        correct: 'Potato'
                    },
                    {
                        image: 'images/당근.png', // 장미 이미지 URL
                        correct: 'Carrot'
                    },
                    {
                        image: 'images/파인애플.png', // 장미 이미지 URL
                        correct: 'Pineapple'
                    },
                    {
                        image: 'images/수박.png', // 장미 이미지 URL
                        correct: 'Watermelon'
                    },
                    {
                        image: 'images/딸기.png', // 장미 이미지 URL
                        correct: 'Strawberry'
                    },
                    {
                        image: 'images/망고.png', // 장미 이미지 URL
                        correct: 'Mango'
                    },
                    {
                        image: 'images/오렌지.png', // 장미 이미지 URL
                        correct: 'Orange'
                    },
                    {
                        image: 'images/포도.png', // 장미 이미지 URL
                        correct: 'Grape'
                    },
                    {
                        image: 'images/바나나.png', // 장미 이미지 URL
                        correct: 'Banana'
                    },
                    {
                        image: 'images/사과.png', // 장미 이미지 URL
                        correct: 'Apple'
                    },
                    {
                        image: 'images/스테이크.png', // 장미 이미지 URL
                        correct: 'Steak'
                    },
                    {
                        image: 'images/치킨.png', // 장미 이미지 URL
                        correct: 'Chicken'
                    },
                    {
                        image: 'images/달걀.png', // 장미 이미지 URL
                        correct: 'Egg'
                    },
                    {
                        image: 'images/요거트.png', // 장미 이미지 URL
                        correct: 'Yogurt'
                    },
                    {
                        image: 'images/치즈.png', // 장미 이미지 URL
                        correct: 'Cheese'
                    },
                    {
                        image: 'images/우유.png', // 장미 이미지 URL
                        correct: 'Milk'
                    },
                    {
                        image: 'images/국수.png', // 장미 이미지 URL
                        correct: 'Noodles'
                    },
                    {
                        image: 'images/피자.png', // 장미 이미지 URL
                        correct: 'Pizza'
                    },
                    {
                        image: 'images/햄버거.png', // 장미 이미지 URL
                        correct: 'Hamburger'
                    },
                    {
                        image: 'images/파스타.png', // 장미 이미지 URL
                        correct: 'Pasta'
                    },
                    {
                        image: 'images/샌드위치.png', // 장미 이미지 URL
                        correct: 'Sandwich'
                    },
                    // 더 많은 쉬운 식물 질문을 추가하세요
                ]    
        };
     



        // 변수 초기화
        let currentQuestionIndex = 0;
        let score = 0;
        let countdown; // 난이도에 따라 다르게 설정
        let countdownInterval;
        let selectedCategory = '';
        let selectedDifficulty = '';
        let filteredQuestions = []; // 선택된 카테고리에 맞는 질문들
        
        const startQuizButton = document.getElementById('startQuizGame');
        const quizContainer = document.getElementById('quizContainer');
        const questionImage = document.getElementById('questionImage');
        const optionsContainer = document.getElementById('options');
        const scoreDisplay = document.getElementById('score');
        const feedback = document.getElementById('feedback');
        const correctAnswerDiv = document.getElementById('correctAnswer'); // 정답 표시 요소
        
        const successMessage = document.getElementById('successMessage');
        const saveRecordButton = document.getElementById('saveRecordButton');
        const restartButton = document.getElementById('restartButton');
    
        const recordSection = document.getElementById('recordSection');
        const playerNameInput = document.getElementById('playerName');
        const submitRecordButton = document.getElementById('submitRecordButton');
        const recordTableBody = document.getElementById('recordTable').querySelector('tbody');
        const closeRecordSectionButton = document.getElementById('closeRecordSection');
        // const backToGameButton = document.getElementById('backToGameButton'); // 제거
        
        const correctSoundEffect = document.getElementById('correctSoundEffect');
        const incorrectSound = document.getElementById('incorrectSound');
    
        // 게임 시작 버튼 이벤트
        startQuizButton.addEventListener('click', () => {
            // 카테고리와 난이도가 선택되었는지 확인
            selectedCategory = document.getElementById('categorySelect').value;
            selectedDifficulty = document.getElementById('difficultySelect').value;
    
            if (!selectedCategory) {
                alert('카테고리를 선택하세요!');
                return;
            }
            if (!selectedDifficulty) {
                alert('난이도를 선택하세요!');
                return;
            }
    
            // 선택된 카테고리에 맞는 질문들 필터링
            if (questions[selectedCategory]) {
                filteredQuestions = [...questions[selectedCategory]];
            } else {
                alert('선택한 카테고리에 맞는 질문이 없습니다.');
                return;
            }
    
            // 퀴즈 시작
            startQuizGame();
        });
        
        // 기록 보기 버튼 이벤트 리스너 추가
        document.getElementById('viewRecordsButton').addEventListener('click', () => {
            recordSection.style.display = 'flex'; // 기록 섹션 표시
            loadRecordsFromFirestore(); // 기록 불러오기 함수 호출
        });
        
        // 게임 시작 함수
        function startQuizGame() {
            if (filteredQuestions.length === 0) {
                alert('선택한 카테고리에 맞는 질문이 없습니다!');
                return;
            }
        
            // 문제를 무작위로 섞고, 최대 20문제 선택
            const shuffledQuestions = filteredQuestions.sort(() => Math.random() - 0.5);
            const selectedQuestions = shuffledQuestions.slice(0, 20);
        
            if (selectedQuestions.length === 0) {
                alert('선택한 카테고리에 문제가 없습니다!');
                return;
            }
        
            // 문제 리스트를 업데이트하고 게임 시작
            currentQuestionIndex = 0;
            score = 0;
            filteredQuestions = selectedQuestions; // 선택된 문제를 저장
            scoreDisplay.textContent = `점수: ${score}`;
            quizContainer.style.display = 'flex';
            startQuizButton.disabled = true;
            loadQuestion();
        }
    
        // 질문 로드 함수 수정
        function loadQuestion() {
            // 난이도에 따라 시간 설정
            if (selectedDifficulty === 'easy') {
                countdown = 5; // 쉬움: 5초
            } else if (selectedDifficulty === 'medium') {
                countdown = 3; // 보통: 3초
            } else if (selectedDifficulty === 'hard') {
                countdown = 2; // 어려움: 2초
            }
            
            if (currentQuestionIndex >= filteredQuestions.length) {
                endQuiz();
                return;
            }

            const currentQuestion = filteredQuestions[currentQuestionIndex];
            questionImage.style.backgroundImage = `url("${currentQuestion.image}")`;
            feedback.innerHTML = ''; // 피드백 초기화
            correctAnswerDiv.innerHTML = ''; // 정답 표시 초기화
            correctAnswerDiv.style.display = 'none'; // 정답 표시 숨김
        
            // 카테고리별 옵션 풀에서 오답 3개 선택
            const category = selectedCategory;
            const correctAnswer = currentQuestion.correct;
            let wrongOptions = optionPools[category].filter(option => option !== correctAnswer);
        
            // 오답이 부족할 경우 옵션 풀에서 중복 없이 가능한 모든 오답 사용
            if (wrongOptions.length < 3) {
                wrongOptions = [...wrongOptions]; // 기존 오답 모두 사용
            }
        
            // 오답을 랜덤으로 섞고 3개 선택
            const shuffledWrongOptions = wrongOptions.sort(() => Math.random() - 0.5);
            const selectedWrongOptions = shuffledWrongOptions.slice(0, 3);
        
            // 정답과 오답을 섞어서 보기 옵션 생성
            const options = [...selectedWrongOptions, correctAnswer].sort(() => Math.random() - 0.5);
        
            // 보기 버튼 생성
            optionsContainer.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.textContent = option;
                button.addEventListener('click', () => selectOption(option, button));
                optionsContainer.appendChild(button);
            });
        
            // 카운트다운 초기화
            feedback.innerHTML = `${countdown}초`;
            countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    feedback.innerHTML = `${countdown}초`;
                } else {
                    clearInterval(countdownInterval);
                    markAsIncorrect(); // 시간이 초과되면 오답 처리
                }
            }, 1000);
        }

        // 보기 선택 함수
// 보기 선택 함수
function selectOption(selectedOption, button) {
    const currentQuestion = filteredQuestions[currentQuestionIndex];
    clearInterval(countdownInterval); // 선택 시 카운트다운 중지

    // 난이도에 따른 점수 설정
    let correctScore, incorrectScore;
    if (selectedDifficulty === 'easy') {
        correctScore = 10;
        incorrectScore = -2;
    } else if (selectedDifficulty === 'medium') {
        correctScore = 20;
        incorrectScore = -4;
    } else if (selectedDifficulty === 'hard') {
        correctScore = 30;
        incorrectScore = -8;
    }

    if (selectedOption === currentQuestion.correct) {
        // 정답
        score += correctScore;
        scoreDisplay.textContent = `점수: ${score}`;
        feedback.innerHTML = '⭕';
        button.style.backgroundColor = '#32cd32'; // 녹색
        correctSoundEffect.play();

        // 애니메이션 클래스 추가
        feedback.classList.add('animate-correct');

        // 애니메이션이 끝난 후 클래스 제거
        feedback.addEventListener('animationend', () => {
            feedback.classList.remove('animate-correct');
        }, { once: true });

    } else {
        // 오답
        score += incorrectScore; // 예: easy는 -2
        scoreDisplay.textContent = `점수: ${score}`;
        feedback.innerHTML = '❌';
        button.style.backgroundColor = '#ff4d4d'; // 빨간색
        incorrectSound.play();

        // 정답 밑줄 표시
        Array.from(optionsContainer.children).forEach(btn => {
            if (btn.textContent === currentQuestion.correct) {
                btn.classList.add('correct-answer');
            }
        });

        // 애니메이션 클래스 추가
        feedback.classList.add('animate-incorrect');

        // 애니메이션이 끝난 후 클래스 제거
        feedback.addEventListener('animationend', () => {
            feedback.classList.remove('animate-incorrect');
        }, { once: true });
    }

    // 모든 보기 버튼 비활성화 및 정답 표시
    Array.from(optionsContainer.children).forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === currentQuestion.correct) {
            btn.style.backgroundColor = '#32cd32'; // 정답 표시
        }
    });

    // 정답 표시
    displayCorrectAnswer(currentQuestion.correct);

    setTimeout(() => {
        nextQuestion();
    }, 2000); // 2초 후 다음 질문으로 이동 (정답 표시 시간 포함)
}

// 시간 초과 시 오답 처리 함수
function markAsIncorrect() {                       
    const currentQuestion = filteredQuestions[currentQuestionIndex];
    
    // 난이도에 따른 오답 점수 설정
    let incorrectScore;
    if (selectedDifficulty === 'easy') {
        incorrectScore = -2;
    } else if (selectedDifficulty === 'medium') {
        incorrectScore = -4;
    } else if (selectedDifficulty === 'hard') {
        incorrectScore = -8;
    }

    score += incorrectScore;
    scoreDisplay.textContent = `점수: ${score}`;
    feedback.innerHTML = '❌';
    
    // 모든 보기 버튼 비활성화 및 정답 표시
    Array.from(optionsContainer.children).forEach(btn => {
        btn.disabled = true;
        if (btn.textContent === currentQuestion.correct) {
            btn.style.backgroundColor = '#32cd32'; // 정답 표시
            btn.classList.add('correct-answer'); // 정답 밑줄 표시
        }
    });
    
    incorrectSound.play();

    // 애니메이션 클래스 추가
    feedback.classList.add('animate-incorrect');

    // 애니메이션이 끝난 후 클래스 제거
    feedback.addEventListener('animationend', () => {
        feedback.classList.remove('animate-incorrect');
    }, { once: true });

    // 정답 표시
    displayCorrectAnswer(currentQuestion.correct);

    // 2초 후 다음 질문으로 이동
    setTimeout(() => {
        nextQuestion();
    }, 2000);
}


        // 정답 표시 함수
        function displayCorrectAnswer(correctAnswer) {
            const message = correctAnswer; // 정답 단어만 읽도록 수정
            correctAnswerDiv.innerHTML = `정답: ${message}`;
            correctAnswerDiv.style.display = 'block';
        
            // 텍스트 음성 변환 (선택 사항)
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(message);

                // 언어 설정: 한글인지 영어인지 판단
                const koreanRegex = /[가-힣]/; // 한글 확인용 정규식
                if (koreanRegex.test(message)) {
                    utterance.lang = 'ko-KR'; // 한국어 발음
                } else {
                    utterance.lang = 'en-US'; // 영어 발음
                }
                speechSynthesis.speak(utterance);
            }
        }
        

        // 다음 질문으로 이동 함수
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }

        // 퀴즈 종료 함수
        function endQuiz() {
            quizContainer.style.display = 'none';
            successMessage.style.display = 'flex';
            clearInterval(countdownInterval);
        }

        // 기록 저장 버튼 이벤트
        saveRecordButton.addEventListener('click', () => {
            successMessage.style.display = 'none';
            recordSection.style.display = 'flex';
            loadRecordsFromFirestore();
        });

        // 기록 제출 버튼 이벤트
        submitRecordButton.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            if (!name) {
                alert('이름을 입력하세요!');
                return;
            }
            saveRecord(name);
        });

        // 게임 재시작 버튼 이벤트
        restartButton.addEventListener('click', () => {
            restartGame();
        });

        // 기록 섹션 닫기 버튼 이벤트
        closeRecordSectionButton.addEventListener('click', () => {
            recordSection.style.display = 'none';
        });

        // Firestore에 기록 저장 함수
        function saveRecord(name) {
            const record = {
                name: name,
                score: score,
                category: selectedCategory,
                difficulty: selectedDifficulty,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };
            db.collection('quizGameRecords').add(record)
                .then(() => {
                    console.log('게임 기록이 성공적으로 저장되었습니다.');
                    playerNameInput.value = '';
                    loadRecordsFromFirestore();
                })
                .catch((error) => {
                    console.error('게임 기록 저장 중 오류 발생: ', error);
                    alert('기록 저장에 실패했습니다. 다시 시도해주세요.');
                });
        }

        // Firestore에서 기록 불러오기 함수
        function loadRecordsFromFirestore() {
            recordTableBody.innerHTML = ''; // 기존 기록 초기화
            db.collection('quizGameRecords').orderBy('score', 'desc').limit(10).get()
                .then((querySnapshot) => {
                    querySnapshot.forEach((doc) => {
                        const record = doc.data();
                        addRecordToTable(record);
                    });
                })
                .catch((error) => {
                    console.error('기록 불러오기 중 오류 발생: ', error);
                });
        }

        // 기록 테이블에 기록 추가 함수
        function addRecordToTable(record) {
            const row = document.createElement('tr');
            const date = record.timestamp ? record.timestamp.toDate().toLocaleString() : 'N/A';
            row.innerHTML = `
                <td>${record.name}</td>
                <td>${record.score}</td>
                <!--<td>${date}</td>--!>
            `;
            recordTableBody.appendChild(row);
        }

        // 게임 재시작 함수 수정
        function restartGame() {
            currentQuestionIndex = 0; // 질문 인덱스 초기화
            score = 0;                 // 점수 초기화
            scoreDisplay.textContent = `점수: ${score}`;
            recordSection.style.display = 'none';    // 기록 섹션 숨기기
            successMessage.style.display = 'none';    // 성공 메시지 숨기기
            playerNameInput.value = '';               // 이름 입력 필드 초기화
            quizContainer.style.display = 'none';      // 퀴즈 컨테이너 숨기기
            startQuizButton.disabled = false;         // "게임 시작" 버튼 활성화
            // 카테고리와 난이도 선택 초기화
            document.getElementById('categorySelect').value = 'animals'; // 기본값으로 'animals' 선택
            document.getElementById('difficultySelect').value = 'easy'; // 기본값으로 'easy' 선택
        }
    </script>
        
</body>
</html>
