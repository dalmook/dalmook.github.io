<!-- ... 기존 HTML 코드 ... -->

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBeCVOghDQw8hPdp0JrHovXcU7d7aKmmFE",
        authDomain: "piecechoice.firebaseapp.com",
        projectId: "piecechoice",
        storageBucket: "piecechoice.firebasestorage.app", // 수정된 버킷 URL
        messagingSenderId: "1048561191876",
        appId: "1:1048561191876:web:43e94b515fd260aceb7291"
    };
    
    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // ... 기존 변수 할당 ...

    // 기록 저장 버튼 이벤트
    saveRecordButton.addEventListener('click', () => {
        const playerName = playerNameInput.value.trim();
        if (!playerName) {
            alert('이름을 입력하세요!');
            return;
        }

        // 타이머에서 초 단위 추출
        const elapsedTimeMatch = timerDisplay.textContent.match(/(\d+)초/);
        const elapsedTime = elapsedTimeMatch ? parseInt(elapsedTimeMatch[1], 10) : 0;

        // 기록 생성
        const newRecord = {
            difficulty: difficultySelect.value,
            name: playerName,
            score: elapsedTime, // 수정된 점수 할당
            timestamp: firebase.firestore.FieldValue.serverTimestamp() // 기록 시간
        };

        // Firestore에 기록 저장
        saveRecord(newRecord).then(() => {
            // 이름 입력 필드 숨기고 기록 테이블 표시
            playerNameInput.style.display = 'none';
            saveRecordButton.style.display = 'none';
        }).catch((error) => {
            console.error('게임 기록 저장 중 오류 발생: ', error);
            alert('기록 저장에 실패했습니다. 다시 시도해주세요.');
        });
    });

    // 게임으로 돌아가기 버튼 이벤트
    backToGameButton.addEventListener('click', () => {
        recordSection.style.display = 'none';
        // 이름 입력 필드와 저장 버튼 다시 보이게 설정
        playerNameInput.style.display = 'block';
        saveRecordButton.style.display = 'block';
        // 게임 초기화
        generateGame(); // 수정된 함수 호출
    });

    // ... 나머지 기존 코드 ...

    // Firestore에서 기록 불러오기
    window.onload = async function() {
        loadRecordsFromFirestore();
        // initializeMatchingGame(); // 이 줄을 제거하거나 주석 처리하세요.
    };
    
    // ... 나머지 기존 코드 ...
</script>

<!-- ... 나머지 HTML 코드 ... -->